name: Simple Deploy for Flask App

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

env:
  PYTHON_VERSION: '3.11'

jobs:
  test-and-build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Run basic tests
      run: |
        # æµ‹è¯•åº”ç”¨æ˜¯å¦å¯ä»¥æ­£å¸¸å¯¼å…¥
        python -c "
        import sys
        sys.path.append('.')
        try:
            from app import app
            from config import Config
            from utils.encryption_engine import EncryptionEngine
            print('âœ… æ‰€æœ‰æ¨¡å—å¯¼å…¥æˆåŠŸ')
        except Exception as e:
            print(f'âŒ å¯¼å…¥å¤±è´¥: {e}')
            sys.exit(1)
        "
    
    - name: Create deployment ready package
      run: |
        # ç¡®ä¿å¿…è¦çš„ç›®å½•å­˜åœ¨
        mkdir -p static/uploads static/password_books
        
        # åˆ›å»ºéƒ¨ç½²çŠ¶æ€æ–‡ä»¶
        echo "Deployment ready at $(date)" > DEPLOYMENT_STATUS.txt
        
        # æ˜¾ç¤ºéƒ¨ç½²ä¿¡æ¯
        echo "ğŸš€ åº”ç”¨å·²å‡†å¤‡å¥½éƒ¨ç½²åˆ°ä»¥ä¸‹å¹³å°ï¼š"
        echo "   â€¢ Railway (æ¨è) - è‡ªåŠ¨æ£€æµ‹Pythonåº”ç”¨"
        echo "   â€¢ Heroku - ä½¿ç”¨Procfile"
        echo "   â€¢ PythonAnywhere - æ‰‹åŠ¨ä¸Šä¼ "
        echo "   â€¢ Render - æ”¯æŒPythonåº”ç”¨"
        
    - name: Upload build artifacts
      uses: actions/upload-artifact@v4
      with:
        name: flask-app-build
        path: |
          .
          !.git
        retention-days: 7

  # Railway éƒ¨ç½²éœ€è¦æ‰‹åŠ¨é…ç½®
  # 1. åœ¨ Railway ç½‘ç«™è¿æ¥ GitHub ä»“åº“
  # 2. Railway ä¼šè‡ªåŠ¨éƒ¨ç½²